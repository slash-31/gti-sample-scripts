<?xml version="1.0" encoding="UTF-8"?>
<svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="800" height="600" fill="#f8f9fa" />
  
  <!-- Title -->
  <text x="400" y="30" font-family="Arial" font-size="20" font-weight="bold" text-anchor="middle">Google Threat Intelligence IoC Management System</text>
  
  <!-- IoC_Pull.py Flow -->
  <rect x="50" y="70" width="300" height="460" rx="10" ry="10" fill="#e6f2ff" stroke="#0066cc" stroke-width="2" />
  <text x="200" y="95" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">IoC_Pull.py</text>
  
  <!-- IoC_Pull Steps -->
  <rect x="70" y="110" width="260" height="60" rx="5" ry="5" fill="#ffffff" stroke="#0066cc" stroke-width="1" />
  <text x="200" y="140" font-family="Arial" font-size="12" text-anchor="middle">Parse command-line arguments</text>
  <text x="200" y="155" font-family="Arial" font-size="10" text-anchor="middle">(threat-actor-id, api-key, limit)</text>
  
  <polygon points="200,170 195,180 205,180" fill="#0066cc" />
  <line x1="200" y1="170" x2="200" y2="190" stroke="#0066cc" stroke-width="2" />
  
  <rect x="70" y="190" width="260" height="60" rx="5" ry="5" fill="#ffffff" stroke="#0066cc" stroke-width="1" />
  <text x="200" y="220" font-family="Arial" font-size="12" text-anchor="middle">Query VirusTotal API for IoCs</text>
  <text x="200" y="235" font-family="Arial" font-size="10" text-anchor="middle">(files, IPs, URLs, domains)</text>
  
  <polygon points="200,250 195,260 205,260" fill="#0066cc" />
  <line x1="200" y1="250" x2="200" y2="270" stroke="#0066cc" stroke-width="2" />
  
  <rect x="70" y="270" width="260" height="60" rx="5" ry="5" fill="#ffffff" stroke="#0066cc" stroke-width="1" />
  <text x="200" y="300" font-family="Arial" font-size="12" text-anchor="middle">Load existing IoCs from JSON</text>
  <text x="200" y="315" font-family="Arial" font-size="10" text-anchor="middle">(IoC_active.json)</text>
  
  <polygon points="200,330 195,340 205,340" fill="#0066cc" />
  <line x1="200" y1="330" x2="200" y2="350" stroke="#0066cc" stroke-width="2" />
  
  <rect x="70" y="350" width="260" height="80" rx="5" ry="5" fill="#ffffff" stroke="#0066cc" stroke-width="1" />
  <text x="200" y="380" font-family="Arial" font-size="12" text-anchor="middle">Compare and update IoCs</text>
  <text x="200" y="395" font-family="Arial" font-size="10" text-anchor="middle">(add new, update existing, remove old)</text>
  <text x="200" y="410" font-family="Arial" font-size="10" text-anchor="middle">with retry logic for API calls</text>
  
  <polygon points="200,430 195,440 205,440" fill="#0066cc" />
  <line x1="200" y1="430" x2="200" y2="450" stroke="#0066cc" stroke-width="2" />
  
  <rect x="70" y="450" width="260" height="60" rx="5" ry="5" fill="#ffffff" stroke="#0066cc" stroke-width="1" />
  <text x="200" y="480" font-family="Arial" font-size="12" text-anchor="middle">Save updated IoCs to JSON</text>
  <text x="200" y="495" font-family="Arial" font-size="10" text-anchor="middle">Log changes in XML format</text>
  
  <!-- IoC_Update.py Flow -->
  <rect x="450" y="70" width="300" height="460" rx="10" ry="10" fill="#f0f7e6" stroke="#339900" stroke-width="2" />
  <text x="600" y="95" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">IoC_Update.py</text>
  
  <!-- IoC_Update Steps -->
  <rect x="470" y="110" width="260" height="60" rx="5" ry="5" fill="#ffffff" stroke="#339900" stroke-width="1" />
  <text x="600" y="140" font-family="Arial" font-size="12" text-anchor="middle">Parse command-line arguments</text>
  <text x="600" y="155" font-family="Arial" font-size="10" text-anchor="middle">(collection-name, api-key)</text>
  
  <polygon points="600,170 595,180 605,180" fill="#339900" />
  <line x1="600" y1="170" x2="600" y2="190" stroke="#339900" stroke-width="2" />
  
  <rect x="470" y="190" width="260" height="60" rx="5" ry="5" fill="#ffffff" stroke="#339900" stroke-width="1" />
  <text x="600" y="220" font-family="Arial" font-size="12" text-anchor="middle">Load IoCs from JSON file</text>
  <text x="600" y="235" font-family="Arial" font-size="10" text-anchor="middle">(IoC_active.json)</text>
  
  <polygon points="600,250 595,260 605,260" fill="#339900" />
  <line x1="600" y1="250" x2="600" y2="270" stroke="#339900" stroke-width="2" />
  
  <rect x="470" y="270" width="260" height="60" rx="5" ry="5" fill="#ffffff" stroke="#339900" stroke-width="1" />
  <text x="600" y="300" font-family="Arial" font-size="12" text-anchor="middle">Check if collection exists</text>
  <text x="600" y="315" font-family="Arial" font-size="10" text-anchor="middle">Create if needed</text>
  
  <polygon points="600,330 595,340 605,340" fill="#339900" />
  <line x1="600" y1="330" x2="600" y2="350" stroke="#339900" stroke-width="2" />
  
  <rect x="470" y="350" width="260" height="80" rx="5" ry="5" fill="#ffffff" stroke="#339900" stroke-width="1" />
  <text x="600" y="380" font-family="Arial" font-size="12" text-anchor="middle">Sync collection with JSON</text>
  <text x="600" y="395" font-family="Arial" font-size="10" text-anchor="middle">(add new IoCs, remove old)</text>
  <text x="600" y="410" font-family="Arial" font-size="10" text-anchor="middle">Display action table</text>
  
  <polygon points="600,430 595,440 605,440" fill="#339900" />
  <line x1="600" y1="430" x2="600" y2="450" stroke="#339900" stroke-width="2" />
  
  <rect x="470" y="450" width="260" height="60" rx="5" ry="5" fill="#ffffff" stroke="#339900" stroke-width="1" />
  <text x="600" y="480" font-family="Arial" font-size="12" text-anchor="middle">Log all actions in XML format</text>
  <text x="600" y="495" font-family="Arial" font-size="10" text-anchor="middle">(IoC_Logs.xml)</text>
  
  <!-- Shared File -->
  <rect x="350" y="250" width="100" height="70" rx="5" ry="5" fill="#ffe6cc" stroke="#ff9900" stroke-width="2" />
  <text x="400" y="280" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle">IoC_active.json</text>
  <text x="400" y="300" font-family="Arial" font-size="10" text-anchor="middle">Shared data file</text>
  
  <!-- Connections to JSON file -->
  <line x1="330" y1="390" x2="350" y2="285" stroke="#0066cc" stroke-width="2" stroke-dasharray="5,3" />
  <polygon points="350,285 342,280 345,290" fill="#0066cc" />
  
  <line x1="470" y1="220" x2="450" y2="260" stroke="#339900" stroke-width="2" stroke-dasharray="5,3" />
  <polygon points="450,260 445,252 455,255" fill="#339900" />
  
  <!-- Log File -->
  <rect x="350" y="350" width="100" height="70" rx="5" ry="5" fill="#f9e6ff" stroke="#9933cc" stroke-width="2" />
  <text x="400" y="380" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle">IoC_Logs.xml</text>
  <text x="400" y="400" font-family="Arial" font-size="10" text-anchor="middle">XML Logs</text>
  
  <!-- Connections to XML file -->
  <line x1="330" y1="480" x2="360" y2="410" stroke="#0066cc" stroke-width="2" stroke-dasharray="5,3" />
  <polygon points="360,410 353,407 358,416" fill="#0066cc" />
  
  <line x1="470" y1="480" x2="440" y2="410" stroke="#339900" stroke-width="2" stroke-dasharray="5,3" />
  <polygon points="440,410 436,417 445,414" fill="#339900" />
  
  <!-- External System -->
  <path d="M 650,90 C 700,90 700,40 650,40 L 550,40 C 500,40 500,90 550,90 Z" fill="#e6e6e6" stroke="#666666" stroke-width="2" />
  <text x="600" y="70" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle">VirusTotal API</text>
  
  <line x1="330" y1="220" x2="550" y2="70" stroke="#0066cc" stroke-width="2" stroke-dasharray="5,3" />
  <polygon points="550,70 542,74 547,65" fill="#0066cc" />
  
  <line x1="730" y1="320" x2="690" y2="90" stroke="#339900" stroke-width="2" stroke-dasharray="5,3" />
  <polygon points="690,90 688,98 697,95" fill="#339900" />
</svg>