# GTI Sample Fetcher

A lightweight CLI tool for retrieving malware sample reports and downloading binaries from [Google Threat Intelligence](https://www.virustotal.com/) (GTI / VirusTotal) using the **v3 REST API**.

---

## Prerequisites

| Requirement | Notes |
|---|---|
| **Python 3.10+** | Uses `X \| None` union syntax (3.10+). Easily back-portable to 3.8+ by changing type hints to `Optional[X]`. |
| **`requests`** | The only external dependency. |
| **GTI API Key** | Obtain from your [GTI / VirusTotal account](https://www.virustotal.com/gui/my-apikey). |
| **Premium / Enterprise API** | Required **only** for the `-d` (download) flag. The `-i` (info) flag works with standard keys. |

## Installation

```bash
# Clone the parent repo (if you haven't already)
git clone git@github.com:slash-31/gti-sample-scripts.git
cd gti-sample-scripts/git_search_last24h_malware

# Install the single dependency
pip install requests
```

## Quick Start

```bash
# Display a colourised report for a known sample (EICAR test file)
python gti_sample.py -k YOUR_API_KEY \
  -H 275a021bbfb6489e54d471899f7db9d1663fc695ec2fe2a2c4538aabf651fd0f \
  -i

# Download a sample to the default ./downloads directory
python gti_sample.py -k YOUR_API_KEY -H HASH -d

# Do both at once, saving to a custom directory
python gti_sample.py -k YOUR_API_KEY -H HASH -i -d -o ./samples
```

## CLI Reference

| Short | Long | Required | Description |
|---|---|---|---|
| `-k` | `--key` | ✅ | GTI / VirusTotal API key |
| `-H` | `--hash` | ✅ | File hash — MD5, SHA-1, or SHA-256 |
| `-i` | `--info` | ⬜ | Display a formatted file report |
| `-d` | `--download` | ⬜ | Download the raw sample binary |
| `-o` | `--output` | ⬜ | Output directory (default: `./downloads`) |
| `-j` | `--json` | ⬜ | Dump raw JSON instead of the pretty report |
| `-q` | `--quiet` | ⬜ | Suppress banners and decorative output |

> **Note:** At least one of `-i` or `-d` must be specified.

## Example Output

```
════════════════════════════════════════════════════════════════════════
  GTI / VirusTotal File Report
════════════════════════════════════════════════════════════════════════

▸ Identification
  Name                   eicar.com
  Type                   EICAR test file  (eicar)
  Size                   68 bytes
  First Submission       2006-05-15 12:30:42 UTC
  Last Analysis          2025-02-20 09:14:03 UTC

▸ Hashes
  MD5                    44d88612fea8a8f36de82e1278abb02f
  SHA-1                  3395856ce81f2b7382dee72602f798b642f14140
  SHA-256                275a021bbfb6489e54d471899f7db9d1663fc695ec2fe2a2c4538aabf651fd0f

▸ Detection
  62/73 engines flagged malicious
  Malicious      62
  Suspicious     0
  Undetected     2
  Harmless       0

▸ Links
  GTI:  https://www.virustotal.com/gui/file/275a021b...

════════════════════════════════════════════════════════════════════════
```

## API Endpoints Used

| Endpoint | Method | Privilege | Purpose |
|---|---|---|---|
| `/api/v3/files/{id}` | `GET` | Standard | Retrieve the full file object / report |
| `/api/v3/files/{id}/download` | `GET` | **Premium** | Download the raw binary (302 → GCS signed URL) |

Full API documentation: <https://gtidocs.virustotal.com/reference/api-overview>

## Report Sections

The `-i` flag displays the following sections (when data is available):

- **Identification** — meaningful name, file type, size, magic string, submission / analysis dates
- **Hashes** — MD5, SHA-1, SHA-256, SSDEEP, TLSH, VHASH
- **Detection** — aggregate AV engine statistics (malicious / suspicious / undetected / harmless)
- **Threat Classification** — GTI's consensus label, categories, and family names
- **Sandbox Verdicts** — per-sandbox detonation results
- **Tags** — GTI-assigned labels (e.g. `peexe`, `upx`, `signed`)
- **Links** — direct URL to the GTI / VT web console

## Safety Warning

> ⚠️ **Downloaded files may be live malware.** Always handle samples in an isolated, sandboxed environment (VM, container, or dedicated analysis workstation). Never execute samples on production systems.

## Project Structure

```
git_search_last24h_malware/
├── gti_sample.py    # Main CLI script
└── README.md        # This file
```

## License

MIT — see the root repository for details.
