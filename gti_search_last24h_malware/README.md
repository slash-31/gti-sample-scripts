# GTI Threat List Fetcher

A CLI tool for pulling the latest **Categorised Threat Lists** from [Google Threat Intelligence](https://www.virustotal.com/) (GTI / VirusTotal) via the v3 API — with optional sample download.

Threat Lists are hourly-generated IoC packages covering ransomware, malware, phishing, infostealers, threat actors, and more. This script lets you fetch, filter, display, export, and bulk-download from any of them.

API Reference: <https://gtidocs.virustotal.com/reference/get-latest-threat-list>

---

## Prerequisites

| Requirement | Notes |
|---|---|
| **Python 3.10+** | Uses `X \| None` union syntax. |
| **`requests`** | The only external dependency. |
| **GTI API Key** | From your [GTI / VirusTotal account](https://www.virustotal.com/gui/my-apikey). |
| **GTI Licence** | Some lists require Enterprise or Enterprise Plus. See the table below. |

## Installation

```bash
cd /path/to/gti-sample-scripts/gti_search_last24h_malware
pip install requests
```

## Quick Start

```bash
# Fetch the latest ransomware file IoCs and display a summary table
python fetch_malware_l24h.py -k YOUR_API_KEY -l ransomware -t file -i

# Export malware IoCs as CSV
python fetch_malware_l24h.py -k YOUR_API_KEY -l malware -t file -f csv -o malware_iocs.csv

# Fetch + download all ransomware samples
python fetch_malware_l24h.py -k YOUR_API_KEY -l ransomware -t file -d -O ./samples

# Filter: only IoCs with malware families, 10+ AV detections, GTI score ≥ 50
python fetch_malware_l24h.py -k YOUR_API_KEY -l malware -t file \
    --has malware_families --positives 10+ --gti-score 50+ -i
```

## CLI Reference

### Required

| Short | Long | Description |
|---|---|---|
| `-k` | `--key` | GTI / VirusTotal API key |
| `-l` | `--list` | Threat list ID (see table below) |

### IoC Type & Format

| Short | Long | Description |
|---|---|---|
| `-t` | `--type` | IoC type filter: `file`, `url`, `domain`, `ip_address` (comma-separated for multiple) |
| `-f` | `--format` | Export format: `json` (default), `csv`, `stix`, `stix-sentinel`, `misp` |
| `-n` | `--limit` | Max number of IoCs to return |

### Display

| Short | Long | Description |
|---|---|---|
| `-i` | `--info` | Display a formatted IoC summary table |
| `-v` | `--verbose` | Detailed per-IoC breakdown with relationships (implies `-i`) |
| `-j` | `--json` | Print raw JSON to stdout |
| `-q` | `--quiet` | Suppress banners |

### Query Filters

| Flag | Description | Example |
|---|---|---|
| `--gti-score` | GTI threat score filter | `50+`, `30-`, `1` |
| `--positives` | AV detection count filter | `10+`, `5-` |
| `--has` | Require relationships | `malware_families`, `campaigns`, `reports`, `threat_actors` |

### Output & Download

| Short | Long | Description |
|---|---|---|
| `-o` | `--output` | Save raw API response to a file |
| `-d` | `--download` | Bulk-download file samples (premium required) |
| `-O` | `--download-dir` | Download directory (default: `./downloads`) |

## Available Threat Lists

| List ID | Entities | Licence |
|---|---|---|
| `ransomware` | files | All |
| `malicious-network-infrastructure` | URLs, domains, IPs | All |
| `malware` | files, URLs, domains, IPs | Enterprise |
| `threat-actor` | files, URLs, domains, IPs | Enterprise |
| `trending` | files, URLs, domains, IPs | Enterprise |
| `mobile` | files | Enterprise Plus |
| `osx` | files | Enterprise Plus |
| `linux` | files | Enterprise Plus |
| `iot` | files | Enterprise Plus |
| `cryptominer` | files, URLs, domains, IPs | Enterprise Plus |
| `phishing` | URLs, domains, IPs | Enterprise Plus |
| `first-stage-delivery-vectors` | files | Enterprise Plus |
| `vulnerability-weaponization` | files, URLs, domains, IPs | Enterprise Plus |
| `infostealer` | files | Enterprise Plus |

## Example Output

```
═══════════════════════════════════════════════════════════════════════════════
  GTI Categorised Threat List — IoC Summary
═══════════════════════════════════════════════════════════════════════════════
  Total IoCs returned: 3

  #    Type         ID / Hash                                                    GTI    AV+   Verdict
  ──── ──────────── ──────────────────────────────────────────────────────────── ────── ───── ────────────
  1    file         92293befae5fa3cc80d1beab93993b254742072879b296f89e9039bdb7…  30     62    malicious
  2    ip_address   198.51.100.42                                                70     8     malicious
  3    url          hxxps://evil-example[.]com/payload.exe                       85     14    malicious

═══════════════════════════════════════════════════════════════════════════════
```

## API Endpoints Used

| Endpoint | Method | Purpose |
|---|---|---|
| `/api/v3/threat_lists/{id}/latest` | `GET` | Fetch the latest hourly threat list |
| `/api/v3/files/{hash}/download` | `GET` | Download a sample binary (premium) |

## Safety Warning

> ⚠️ **Downloaded files may be live malware.** Always handle samples in an isolated, sandboxed environment. Never execute samples on production systems.

## Project Structure

```
gti_search_last24h_malware/
├── fetch_malware_l24h.py   # Main CLI script
└── README.md               # This file
```

## License

MIT — see the root repository for details.
